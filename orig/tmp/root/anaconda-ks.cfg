#version=DEVEL
# Use text mode install
text
# Firewall configuration
firewall --disabled
firstboot --disable
ignoredisk --only-use=vda
# Keyboard layouts
# old format: keyboard us
# new format:
keyboard --vckeymap=us --xlayouts=''
# System language
lang en_US.UTF-8

# Network information
network  --bootproto=dhcp --device=eth0 --ipv6=auto --activate
network  --hostname=localhost.localdomain
# Reboot after installation
reboot
repo --name="koji-override-0" --baseurl=http://download.devel.redhat.com/composes/released/RHEL-7/7.9/Server/x86_64/os/
repo --name="koji-override-1" --baseurl=http://rhsm-pulp.corp.redhat.com/content/dist/rhel/system-z/7/7Server/s390x/os
repo --name="koji-override-2" --baseurl=http://rhsm-pulp.corp.redhat.com/content/dist/rhel/power-le/7/7Server/ppc64le/os
repo --name="koji-override-3" --baseurl=http://rhsm-pulp.corp.redhat.com/content/dist/rhel/server/7/7Server/x86_64/os
repo --name="Server-HighAvailability" --baseurl=http://download.eng.bos.redhat.com/composes/released/RHEL-7/7.9/Server/x86_64/os//addons/HighAvailability
repo --name="Server-ResilientStorage" --baseurl=http://download.eng.bos.redhat.com/composes/released/RHEL-7/7.9/Server/x86_64/os//addons/ResilientStorage
# Use network installation
url --url="http://download.eng.bos.redhat.com/composes/released/RHEL-7/7.9/Server/x86_64/os/"
# Root password
rootpw --iscrypted --lock locked
# System services
services --disabled="chronyd"
# Do not configure the X Window System
skipx
# System timezone
timezone UTC --isUtc --nontp
user --name=none
# System bootloader configuration
bootloader --disabled
autopart --type=plain
# Clear the Master Boot Record
zerombr
# Partition clearing information
clearpart --all

%post --logfile=/var/log/anaconda/anaconda-post.log

#RCM-18944 - forcibly remove qemu-guest-agent if still present
#https://bugzilla.redhat.com/show_bug.cgi?id=147.881
yum --assumeyes erase qemu-guest-agent

#https://bugzilla.redhat.com/show_bug.cgi?id=1536174
yum --assumeyes erase blktrace ethtool fuse-libs groff-base hostname initscripts iproute iptables iputils libaio libmnl libnetfilter_conntrack libnfnetlink libsysfs lsscsi mariadb-libs perl perl-Carp perl-Data-Dumper perl-Encode perl-Exporter perl-File-Path perl-File-Temp perl-Filter perl-Getopt-Long perl-HTTP-Tiny perl-PathTools perl-Pod-Escapes perl-Pod-Perldoc perl-Pod-Simple perl-Pod-Usage perl-Scalar-List-Utils perl-Socket perl-Storable perl-Text-ParseWords perl-Time-HiRes perl-Time-Local perl-constant perl-libs perl-macros perl-parent perl-podlators perl-threads perl-threads-shared psmisc rsync s390utils s390utils-base s390utils-cmsfs s390utils-cpuplugd s390utils-iucvterm s390utils-mon_statd s390utils-osasnmpd s390utils-ziomon sg3_utils sg3_utils-libs sysfsutils systemd-sysv sysvinit-tools tcp_wrappers-libs device-mapper-multipath device-mapper-multipath-libs net-snmp net-snmp-agent-libs net-snmp-libs

#s390x - remove bc: https://bugzilla.redhat.com/show_bug.cgi?id=1897487
yum --assumeyes erase bc

# remove the user anaconda forces us to make
userdel -r none

# Support for subscription-manager secrets
ln -s /run/secrets/etc-pki-entitlement /etc/pki/entitlement-host
ln -s /run/secrets/rhsm /etc/rhsm-host

# Set the language rpm nodocs transaction flag persistently in the
# image yum.conf and rpm macros

LANG="en_US"
echo "%_install_lang $LANG" > /etc/rpm/macros.image-language-conf

awk '(NF==0&&!done){print "override_install_langs='$LANG'\ntsflags=nodocs";done=1}{print}' \
    < /etc/yum.conf > /etc/yum.conf.new
mv /etc/yum.conf.new /etc/yum.conf

#systemd wrongly expects "unpopulated /etc" when /etc/machine-id does not exist
#let's leave machine-id empty
cat /dev/null > /etc/machine-id

#https://bugzilla.redhat.com/show_bug.cgi?id=1235969
#rm -f /etc/fstab
#this is not possible, guestmount needs fstab => brew build crashes without it
#fstab is removed in TDL when tar-ing files

rm -f /usr/lib/locale/locale-archive
#setup at least some locale, https://bugzilla.redhat.com/show_bug.cgi?id=1129697
localedef -v -c -i en_US -f UTF-8 en_US.UTF-8

#https://bugzilla.redhat.com/show_bug.cgi?id=1201663
rm -f /etc/systemd/system/multi-user.target.wants/rhsmcertd.service

#Mask mount units and getty service so that we don't get login prompt
#https://bugzilla.redhat.com/show_bug.cgi?id=1418327
systemctl mask systemd-logind.service getty.target console-getty.service sys-fs-fuse-connections.mount
#systemd-remount-fs.service dev-hugepages.mount  ?

#content of /run can not be prepared if /run is tmpfs (disappears on reboot)
umount /run
systemd-tmpfiles --create

#fips mode
# secrets patch creates /run/secrets/system-fips if /etc/system-fips exists on the host
#in turn, openssl in the container checks /etc/system-fips but dangling symlink counts as nonexistent
ln -s /run/secrets/system-fips /etc/system-fips

#udev hardware database not needed in a container
rm -f /etc/udev/hwdb.bin
rm -rf /usr/lib/udev/hwdb.d/*

rm -rf /var/cache/yum/*
rm -f /tmp/ks-script*
#rhbz 1732224 Remove anaconda install logs
rm -rf /var/log/anaconda


# remove the original RHEL7 EULA
# TODO: This affects the integrity of the installed rpm. Find a better way.
rm -f /usr/share/redhat-release/EULA

# install the repofile
#
# Get machine type from uname
HARDWARE=$(uname --machine)
#
# x86_64
#
if [[ $HARDWARE == "x86_64" ]]; then 
   cat > /etc/yum.repos.d/ubi.repo <<EOF
[ubi-7]
name = Red Hat Universal Base Image 7 Server (RPMs)
baseurl = https://cdn-ubi.redhat.com/content/public/ubi/dist/ubi/server/7/7Server/\$basearch/os
enabled = 1
gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
gpgcheck = 1

[ubi-7-server-debug-rpms]
name = Red Hat Universal Base Image 7 Server (Debug RPMs)
baseurl = https://cdn-ubi.redhat.com/content/public/ubi/dist/ubi/server/7/7Server/\$basearch/debug
enabled = 0
gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
gpgcheck = 1

[ubi-7-server-source-rpms]
name = Red Hat Universal Base Image 7 Server (Source RPMs)
baseurl = https://cdn-ubi.redhat.com/content/public/ubi/dist/ubi/server/7/7Server/\$basearch/source/SRPMS
enabled = 0
gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
gpgcheck = 1

[ubi-7-server-optional-rpms]
name = Red Hat Universal Base Image 7 Server - Optional (RPMs)
baseurl = https://cdn-ubi.redhat.com/content/public/ubi/dist/ubi/server/7/7Server/\$basearch/optional/os
enabled = 1
gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
gpgcheck = 1

[ubi-7-server-optional-debug-rpms]
name = Red Hat Universal Base Image 7 Server - Optional (Debug RPMs)
baseurl = https://cdn-ubi.redhat.com/content/public/ubi/dist/ubi/server/7/7Server/\$basearch/optional/debug
enabled = 0
gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
gpgcheck = 1

[ubi-7-server-optional-source-rpms]
name = Red Hat Universal Base Image 7 Server - Optional (Source RPMs)
baseurl = https://cdn-ubi.redhat.com/content/public/ubi/dist/ubi/server/7/7Server/\$basearch/optional/source/SRPMS
enabled = 0
gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
gpgcheck = 1

[ubi-7-server-extras-rpms]
name = Red Hat Universal Base Image 7 Server - Extras (RPMs)
baseurl = https://cdn-ubi.redhat.com/content/public/ubi/dist/ubi/server/7/7Server/\$basearch/extras/os
enabled = 1
gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
gpgcheck = 1

[ubi-7-server-extras-debug-rpms]
name = Red Hat Universal Base Image 7 Server - Extras (Debug RPMs)
baseurl = https://cdn-ubi.redhat.com/content/public/ubi/dist/ubi/server/7/7Server/\$basearch/extras/debug
enabled = 0
gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
gpgcheck = 1

[ubi-7-server-extras-source-rpms]
name = Red Hat Universal Base Image 7 Server - Extras (Source RPMs)
baseurl = https://cdn-ubi.redhat.com/content/public/ubi/dist/ubi/server/7/7Server/\$basearch/extras/source/SRPMS
enabled = 0
gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
gpgcheck = 1

[ubi-7-rhah]
name = Red Hat Universal Base Image Atomic Host (RPMs)
baseurl = https://cdn-ubi.redhat.com/content/public/ubi/dist/ubi/atomic/7/7Server/\$basearch/os
enabled = 1
gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
gpgcheck = 1

[ubi-7-rhah-debug]
name = Red Hat Universal Base Image Atomic Host (Debug RPMs)
baseurl = https://cdn-ubi.redhat.com/content/public/ubi/dist/ubi/atomic/7/7Server/\$basearch/debug
enabled = 0
gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
gpgcheck = 1

[ubi-7-rhah-source]
name = Red Hat Universal Base Image Atomic Host (Source RPMs)
baseurl = https://cdn-ubi.redhat.com/content/public/ubi/dist/ubi/atomic/7/7Server/\$basearch/source/SRPMS
enabled = 0
gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
gpgcheck = 1

[ubi-server-rhscl-7-rpms]
name = Red Hat Software Collections RPMs for Red Hat Universal Base Image 7 Server
baseurl = https://cdn-ubi.redhat.com/content/public/ubi/dist/ubi/server/7/7Server/\$basearch/rhscl/1/os
enabled = 1
gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
gpgcheck = 1

[ubi-server-rhscl-7-debug-rpms]
name = Red Hat Software Collections Debug RPMs for Red Hat Universal Base Image 7 Server
baseurl = https://cdn-ubi.redhat.com/content/public/ubi/dist/ubi/server/7/7Server/\$basearch/rhscl/1/debug
enabled = 0
gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
gpgcheck = 1

[ubi-server-rhscl-7-source-rpms]
name = Red Hat Software Collections Source RPMs for Red Hat Universal Base Image 7 Server
baseurl = https://cdn-ubi.redhat.com/content/public/ubi/dist/ubi/server/7/7Server/\$basearch/rhscl/1/source/SRPMS
enabled = 0
gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
gpgcheck = 1

[ubi-7-server-devtools-rpms]
name = Red Hat Developer Tools RPMs for Red Hat Universal Base Image 7 Server
baseurl = https://cdn-ubi.redhat.com/content/public/ubi/dist/ubi/server/7/7Server/\$basearch/devtools/1/os
enabled = 0
gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
gpgcheck = 1

[ubi-7-server-devtools-debug-rpms]
name = Red Hat Developer Tools Debug RPMs for Red Hat Universal Base Image 7 Server
baseurl = https://cdn-ubi.redhat.com/content/public/ubi/dist/ubi/server/7/7Server/\$basearch/devtools/1/debug
enabled = 0
gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
gpgcheck = 1

[ubi-7-server-devtools-source-rpms]
name = Red Hat Developer Tools Source RPMs for Red Hat Universal Base Image 7 Server
baseurl = https://cdn-ubi.redhat.com/content/public/ubi/dist/ubi/server/7/7Server/\$basearch/devtools/1/source/SRPMS
enabled = 0
gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
gpgcheck = 1
EOF
#
# IBM Power LE (ppc64le)
#
elif [[ $HARDWARE == "ppc64le" ]] ; then
   cat > /etc/yum.repos.d/ubi.repo <<EOF
[ubi-7-for-power-le-rpms]
name = Red Hat Universal Base Image 7 for IBM Power LE (RPMs)
baseurl = https://cdn-ubi.redhat.com/content/public/ubi/dist/ubi/power-le/7/7Server/\$basearch/os
enabled = 1
gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
gpgcheck = 1

[ubi-7-for-power-le-debug-rpms]
name = Red Hat Universal Base Image 7 for IBM Power LE (Debug RPMs)
baseurl = https://cdn-ubi.redhat.com/content/public/ubi/dist/ubi/power-le/7/7Server/\$basearch/debug
enabled = 0
gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
gpgcheck = 1

[ubi-7-for-power-le-source-rpms]
name = Red Hat Universal Base Image 7 for IBM Power LE (Source RPMs)
baseurl = https://cdn-ubi.redhat.com/content/public/ubi/dist/ubi/power-le/7/7Server/\$basearch/source/SRPMS
enabled = 0
gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
gpgcheck = 1

[ubi-7-for-power-le-optional-rpms]
name = Red Hat Universal Base Image 7 for IBM Power LE - Optional (RPMs)
baseurl = https://cdn-ubi.redhat.com/content/public/ubi/dist/ubi/power-le/7/7Server/\$basearch/optional/os
enabled = 1
gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
gpgcheck = 1

[ubi-7-for-power-le-optional-debug-rpms]
name = Red Hat Universal Base Image 7 for IBM Power LE - Optional (Debug RPMs)
baseurl = https://cdn-ubi.redhat.com/content/public/ubi/dist/ubi/power-le/7/7Server/\$basearch/optional/debug
enabled = 0
gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
gpgcheck = 1

[ubi-7-for-power-le-optional-source-rpms]
name = Red Hat Universal Base Image 7 for IBM Power LE - Optional (Source RPMs)
baseurl = https://cdn-ubi.redhat.com/content/public/ubi/dist/ubi/power-le/7/7Server/\$basearch/optional/source/SRPMS
enabled = 0
gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
gpgcheck = 1

[ubi-7-for-power-le-extras-rpms]
name = Red Hat Universal Base Image 7 for IBM Power LE - Extras (RPMs)
baseurl = https://cdn-ubi.redhat.com/content/public/ubi/dist/ubi/power-le/7/7Server/\$basearch/extras/os
enabled = 0
gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
gpgcheck = 1

[ubi-7-for-power-le-extras-debug-rpms]
name = Red Hat Universal Base Image 7 for IBM Power LE - Extras (Debug RPMs)
baseurl = https://cdn-ubi.redhat.com/content/public/ubi/dist/ubi/power-le/7/7Server/\$basearch/extras/debug
enabled = 0
gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
gpgcheck = 1

[ubi-7-for-power-le-extras-source-rpms]
name = Red Hat Universal Base Image 7 for IBM Power LE - Extras (Source RPMs)
baseurl = https://cdn-ubi.redhat.com/content/public/ubi/dist/ubi/power-le/7/7Server/\$basearch/extras/source/SRPMS
enabled = 0
gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
gpgcheck = 1

[ubi-7-for-power-le-rhah]
name = Red Hat Universal Base Image Atomic Host for IBM Power LE (RPMs)
baseurl = https://cdn-ubi.redhat.com/content/public/ubi/dist/ubi/atomic/7/7Server/\$basearch/os
enabled = 1
gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
gpgcheck = 1

[ubi-7-for-power-le-rhah-debug]
name = Red Hat Universal Base Image Atomic Host for IBM Power LE (Debug RPMs)
baseurl = https://cdn-ubi.redhat.com/content/public/ubi/dist/ubi/atomic/7/7Server/\$basearch/debug
enabled = 0
gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
gpgcheck = 1

[ubi-7-for-power-le-rhah-source]
name = Red Hat Universal Base Image Atomic Host for IBM Power LE (Source RPMs)
baseurl = https://cdn-ubi.redhat.com/content/public/ubi/dist/ubi/atomic/7/7Server/\$basearch/source/SRPMS
enabled = 0
gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
gpgcheck = 1

[ubi-7-server-for-power-le-rhscl-rpms]
name = Red Hat Software Collections (for UBI 7 Server for IBM Power LE) RPMs
baseurl = https://cdn-ubi.redhat.com/content/public/ubi/dist/ubi/power-le/7/7Server/\$basearch/rhscl/1/os
enabled = 1
gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
gpgcheck = 1

[ubi-7-server-for-power-le-rhscl-debug-rpms]
name = Red Hat Software Collections (for UBI 7 Server for IBM Power LE) Debug RPMs
baseurl = https://cdn-ubi.redhat.com/content/public/ubi/dist/ubi/power-le/7/7Server/\$basearch/rhscl/1/debug
enabled = 0
gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
gpgcheck = 1

[ubi-7-server-for-power-le-rhscl-source-rpms]
name = Red Hat Software Collections (for UBI 7 Server for IBM Power LE) Source RPMs
baseurl = https://cdn-ubi.redhat.com/content/public/ubi/dist/ubi/power-le/7/7Server/\$basearch/rhscl/1/source/SRPMS
enabled = 0
gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
gpgcheck = 1

[ubi-7-server-for-power-le-devtools-rpms]
name = Red Hat Developer Tools (for UBI 7 Server for IBM Power LE) RPMs
baseurl = https://cdn-ubi.redhat.com/content/public/ubi/dist/ubi/power-le/7/7Server/\$basearch/devtools/1/os
enabled = 0
gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
gpgcheck = 1

[ubi-7-server-for-power-le-devtools-debug-rpms]
name = Red Hat Developer Tools (for UBI 7 Server for IBM Power LE) Debug RPMs
baseurl = https://cdn-ubi.redhat.com/content/public/ubi/dist/ubi/power-le/7/7Server/\$basearch/devtools/1/debug
enabled = 0
gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
gpgcheck = 1

[ubi-7-server-for-power-le-devtools-source-rpms]
name = Red Hat Developer Tools (for UBI 7 Server for IBM Power LE) Source RPMs
baseurl = https://cdn-ubi.redhat.com/content/public/ubi/dist/ubi/power-le/7/7Server/\$basearch/devtools/1/source/SRPMS
enabled = 0
gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
gpgcheck = 1
EOF
#
# IBM System Z (s390x)
#
elif [[ $HARDWARE == "s390x" ]] ; then
   cat > /etc/yum.repos.d/ubi.repo <<EOF
[ubi-7-for-system-z-rpms]
name = Red Hat Universal Base Image 7 for System Z (RPMs)
baseurl = https://cdn-ubi.redhat.com/content/public/ubi/dist/ubi/system-z/7/7Server/\$basearch/os
enabled = 1
gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
gpgcheck = 1

[ubi-7-for-system-z-debug-rpms]
name = Red Hat Universal Base Image 7 for System Z (Debug RPMs)
baseurl = https://cdn-ubi.redhat.com/content/public/ubi/dist/ubi/system-z/7/7Server/\$basearch/debug
enabled = 0
gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
gpgcheck = 1

[ubi-7-for-system-z-source-rpms]
name = Red Hat Universal Base Image 7 for System Z (Source RPMs)
baseurl = https://cdn-ubi.redhat.com/content/public/ubi/dist/ubi/system-z/7/7Server/\$basearch/source/SRPMS
enabled = 0
gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
gpgcheck = 1

[ubi-7-for-system-z-optional-rpms]
name = Red Hat Universal Base Image 7 for System Z - Optional (RPMs)
baseurl = https://cdn-ubi.redhat.com/content/public/ubi/dist/ubi/system-z/7/7Server/\$basearch/optional/os
enabled = 1
gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
gpgcheck = 1

[ubi-7-for-system-z-optional-debug-rpms]
name = Red Hat Universal Base Image 7 for System Z - Optional (Debug RPMs)
baseurl = https://cdn-ubi.redhat.com/content/public/ubi/dist/ubi/system-z/7/7Server/\$basearch/optional/debug
enabled = 0
gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
gpgcheck = 1

[ubi-7-for-system-z-optional-source-rpms]
name = Red Hat Universal Base Image 7 for System Z - Optional (Source RPMs)
baseurl = https://cdn-ubi.redhat.com/content/public/ubi/dist/ubi/system-z/7/7Server/\$basearch/optional/source/SRPMS
enabled = 0
gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
gpgcheck = 1

[ubi-7-for-system-z-extras-debug-rpms]
name = Red Hat Universal Base Image 7 for System Z - Extras (Debug RPMs)
baseurl = https://cdn-ubi.redhat.com/content/public/ubi/dist/ubi/system-z/7/7Server/\$basearch/extras/debug
enabled = 0
gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
gpgcheck = 1

[ubi-7-for-system-z-extras-rpms]
name = Red Hat Universal Base Image 7 for System Z - Extras (RPMs)
baseurl = https://cdn-ubi.redhat.com/content/public/ubi/dist/ubi/system-z/7/7Server/\$basearch/extras/os
enabled = 0
gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
gpgcheck = 1

[ubi-7-for-system-z-extras-source-rpms]
name = Red Hat Universal Base Image 7 for System Z - Extras (Source RPMs)
baseurl = https://cdn-ubi.redhat.com/content/public/ubi/dist/ubi/system-z/7/7Server/\$basearch/extras/source/SRPMS
enabled = 0
gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
gpgcheck = 1

[ubi-7-for-system-z-rhah]
name = Red Hat Universal Base Image Atomic Host for System Z (RPMs)
baseurl = https://cdn-ubi.redhat.com/content/public/ubi/dist/ubi/atomic/7/7Server/\$basearch/os
enabled = 1
gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
gpgcheck = 1

[ubi-7-for-system-z-rhah-debug]
name = Red Hat Universal Base Image Atomic Host for System Z (Debug RPMs)
baseurl = https://cdn-ubi.redhat.com/content/public/ubi/dist/ubi/atomic/7/7Server/\$basearch/debug
enabled = 0
gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
gpgcheck = 1

[ubi-7-for-system-z-rhah-source]
name = Red Hat Universal Base Image Atomic Host for System Z (Source RPMs)
baseurl = https://cdn-ubi.redhat.com/content/public/ubi/dist/ubi/atomic/7/7Server/\$basearch/source/SRPMS
enabled = 0
gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
gpgcheck = 1

[ubi-7-server-for-system-z-rhscl-rpms]
name = Red Hat Software Collections (for UBI 7 Server for System Z) RPMs
baseurl = https://cdn-ubi.redhat.com/content/public/ubi/dist/ubi/system-z/7/7Server/\$basearch/rhscl/1/os
enabled = 1
gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
gpgcheck = 1

[ubi-7-server-for-system-z-rhscl-debug-rpms]
name = Red Hat Software Collections (for UBI 7 Server for System Z) Debug RPMs
baseurl = https://cdn-ubi.redhat.com/content/public/ubi/dist/ubi/system-z/7/7Server/\$basearch/rhscl/1/debug
enabled = 0
gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
gpgcheck = 1

[ubi-7-server-for-system-z-rhscl-source-rpms]
name = Red Hat Software Collections (for UBI 7 Server for System Z) Source RPMs
baseurl = https://cdn-ubi.redhat.com/content/public/ubi/dist/ubi/system-z/7/7Server/\$basearch/rhscl/1/source/SRPMS
enabled = 0
gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
gpgcheck = 1

[ubi-7-server-for-system-z-devtools-rpms]
name = Red Hat Developer Tools (for UBI 7 Server for System Z) RPMs
baseurl = https://cdn-ubi.redhat.com/content/public/ubi/dist/ubi/system-z/7/7Server/\$basearch/devtools/1/os
enabled = 0
gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
gpgcheck = 1

[ubi-7-server-for-system-z-devtools-debug-rpms]
name = Red Hat Developer Tools (for UBI 7 Server for System Z) Debug RPMs
baseurl = https://cdn-ubi.redhat.com/content/public/ubi/dist/ubi/system-z/7/7Server/\$basearch/devtools/1/debug
enabled = 0
gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
gpgcheck = 1

[ubi-7-server-for-system-z-devtools-source-rpms]
name = Red Hat Developer Tools (for UBI 7 Server for System Z) Source RPMs
baseurl = https://cdn-ubi.redhat.com/content/public/ubi/dist/ubi/system-z/7/7Server/\$basearch/devtools/1/source/SRPMS
enabled = 0
gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
gpgcheck = 1
EOF
fi

%end

%packages --excludedocs --nobase --nocore --instLangs=en
bash
findutils
gdb-gdbserver
kexec-tools
python-rhsm
redhat-release-server
rootfiles
subscription-manager
systemd
vim-minimal
yum
yum-plugin-ovl
yum-utils
-e2fsprogs
-firewalld
-kernel
-kexec-tools
-xfsprogs

%end

%addon com_redhat_kdump --enable --reserve-mb='auto'

%end
